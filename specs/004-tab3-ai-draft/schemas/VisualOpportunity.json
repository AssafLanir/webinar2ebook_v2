{
  "$defs": {
    "VisualPlacement": {
      "enum": [
        "after_heading",
        "inline",
        "end_of_section",
        "end_of_chapter",
        "sidebar"
      ],
      "title": "VisualPlacement",
      "type": "string"
    },
    "VisualSourcePolicy": {
      "enum": [
        "client_assets_only",
        "allow_new_suggestions"
      ],
      "title": "VisualSourcePolicy",
      "type": "string"
    },
    "VisualType": {
      "enum": [
        "screenshot",
        "diagram",
        "chart",
        "table",
        "icon",
        "photo",
        "other"
      ],
      "title": "VisualType",
      "type": "string"
    }
  },
  "additionalProperties": false,
  "properties": {
    "id": {
      "description": "Stable id for UI selection/acceptance",
      "title": "Id",
      "type": "string"
    },
    "chapter_index": {
      "description": "1-based chapter index",
      "minimum": 1,
      "title": "Chapter Index",
      "type": "integer"
    },
    "section_path": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Optional fine-grained section identifier (e.g. \"2.3\" or heading slug)",
      "title": "Section Path"
    },
    "placement": {
      "allOf": [
        {
          "$ref": "#/$defs/VisualPlacement"
        }
      ],
      "default": "after_heading"
    },
    "visual_type": {
      "allOf": [
        {
          "$ref": "#/$defs/VisualType"
        }
      ],
      "description": "What kind of visual this should be"
    },
    "source_policy": {
      "allOf": [
        {
          "$ref": "#/$defs/VisualSourcePolicy"
        }
      ],
      "default": "client_assets_only"
    },
    "title": {
      "description": "Short title for the visual (used as figure title or label)",
      "title": "Title",
      "type": "string"
    },
    "prompt": {
      "description": "What the visual should show (LLM-generated description)",
      "title": "Prompt",
      "type": "string"
    },
    "caption": {
      "description": "Caption text shown under the visual",
      "title": "Caption",
      "type": "string"
    },
    "required": {
      "default": false,
      "description": "If true, the draft should include a placeholder even if no asset",
      "title": "Required",
      "type": "boolean"
    },
    "candidate_asset_ids": {
      "description": "If any known assets fit, list their ids",
      "items": {
        "type": "string"
      },
      "title": "Candidate Asset Ids",
      "type": "array"
    },
    "confidence": {
      "default": 0.6,
      "maximum": 1.0,
      "minimum": 0.0,
      "title": "Confidence",
      "type": "number"
    },
    "rationale": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Why this visual helps the reader",
      "title": "Rationale"
    }
  },
  "required": [
    "id",
    "chapter_index",
    "visual_type",
    "title",
    "prompt",
    "caption"
  ],
  "title": "VisualOpportunity",
  "type": "object"
}